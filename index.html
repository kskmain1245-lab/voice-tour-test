<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼ä¿®æ­£ç‰ˆ</title>
<style>
  body { font-family: sans-serif; text-align: center; padding: 20px; background-color: #f0f8ff; }
  .card { background: white; padding: 20px; margin: 10px auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); max-width: 400px; }
  h1 { color: #333; }
  button { font-size: 1.2em; padding: 10px 20px; background-color: #ff6347; color: white; border: none; border-radius: 5px; cursor: pointer; }
  #status { margin-top: 20px; font-weight: bold; min-height: 1.5em; }
  .spot-list { list-style: none; padding: 0; }
  .spot-item { background: #eee; margin: 5px; padding: 10px; border-radius: 5px; }
  .cleared { background-color: #98fb98; font-weight: bold; color: #006400; }
  
  /* ãƒªãƒ“ã‚¸ãƒ§ãƒ³è¡¨è¨˜ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆç›®ç«‹ãŸãªã„ç°è‰²ï¼‰ */
  .revision { font-size: 10px; color: #aaa; margin-top: 20px; }
</style>
</head>
<body>

<div class="card">
  <h1>ğŸ—ºï¸ éŸ³å£°ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</h1>
  <p>ç¾åœ¨åœ°ã‚’å–å¾—ã§ãã‚‹ã‹<br>å†ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
  <button onclick="startTour()">ãƒ„ã‚¢ãƒ¼ã‚’é–‹å§‹ï¼ˆGPSè¨±å¯ï¼‰</button>
  <div id="status">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
  
  <div id="debug" style="color:red; font-size:0.8em; margin-top:10px;"></div>
</div>

<div class="card">
  <h3>ã‚¹ã‚¿ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰</h3>
  <ul id="spotList" class="spot-list">
    </ul>
  
  <p class="revision">Rev. 3 (GPSä¿®æ­£ç‰ˆ)</p>
</div>

<script>
// â˜…è¨­å®šï¼šã”æŒ‡å®šã®å ´æ‰€â˜…
const spots = [
  { name: "â‘  æŒ‡å®šã®ãƒ†ã‚¹ãƒˆåœ°ç‚¹", lat: 34.83497127593877, lng: 134.67767961322787, cleared: false },
  { name: "â‘¡ åŒ—ã®ã‚¹ãƒãƒƒãƒˆ", lat: 34.8369, lng: 134.6776, cleared: false } 
];

const RADIUS = 50; // åŠå¾„50m

function startTour() {
  if (!navigator.geolocation) {
    alert("ãŠä½¿ã„ã®ç«¯æœ«ã§ã¯GPSãŒä½¿ãˆã¾ã›ã‚“");
    return;
  }

  document.getElementById("status").innerText = "ğŸ“¡ GPSèµ·å‹•ä¸­...";
  
  // GPSå–å¾—é–‹å§‹
  navigator.geolocation.watchPosition(success, error, {
    enableHighAccuracy: true,
    timeout: 10000,
    maximumAge: 0
  });

  updateList();
}

function success(position) {
  const currentLat = position.coords.latitude;
  const currentLng = position.coords.longitude;
  
  document.getElementById("status").innerHTML = 
    `ğŸ“ ç¾åœ¨åœ°<br>${currentLat.toFixed(5)}, ${currentLng.toFixed(5)}`;
  
  document.getElementById("debug").innerText = "";

  spots.forEach((spot) => {
    if (spot.cleared) return;

    const dist = getDistance(currentLat, currentLng, spot.lat, spot.lng);
    
    if (dist <= RADIUS) {
      spot.cleared = true;
      
      const audio = new Audio('spot1.mp3');
      audio.play().catch(e => {
         // è‡ªå‹•å†ç”Ÿãƒ–ãƒ­ãƒƒã‚¯æ™‚
         alert("ã‚¹ã‚¿ãƒ³ãƒ—ã‚²ãƒƒãƒˆï¼\nï¼ˆç”»é¢ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨éŸ³ãŒé³´ã‚Šã¾ã™ï¼‰");
      });

      alert(`ğŸ‰ ${spot.name} ã«åˆ°ç€ï¼`);
      updateList();
    }
  });
}

function error(err) {
  const errorMsg = `ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ${err.code}\nå†…å®¹: ${err.message}`;
  document.getElementById("status").innerText = "âš ï¸ GPSã‚¨ãƒ©ãƒ¼";
  document.getElementById("debug").innerText = errorMsg;
