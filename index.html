<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>éŸ³å£°ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼ä¿®æ­£ç‰ˆ</title>
<style>
  body { font-family: sans-serif; text-align: center; padding: 20px; background-color: #f0f8ff; }
  .card { background: white; padding: 20px; margin: 10px auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); max-width: 400px; }
  h1 { color: #333; }
  button { font-size: 1.2em; padding: 10px 20px; background-color: #ff6347; color: white; border: none; border-radius: 5px; cursor: pointer; }
  #status { margin-top: 20px; font-weight: bold; min-height: 1.5em; }
  .spot-list { list-style: none; padding: 0; }
  .spot-item { background: #eee; margin: 5px; padding: 10px; border-radius: 5px; }
  .cleared { background-color: #98fb98; font-weight: bold; color: #006400; }
  
  /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç›®ç«‹ãŸã›ã‚‹ã‚¹ã‚¿ã‚¤ãƒ« */
  .success-msg { color: red; font-size: 1.2em; font-weight: bold; animation: pop 0.5s ease; }
  @keyframes pop { 0% { transform: scale(0.8); } 50% { transform: scale(1.2); } 100% { transform: scale(1.0); } }
  
  .revision { font-size: 10px; color: #aaa; margin-top: 20px; }
</style>
</head>
<body>

<div class="card">
  <h1>ğŸ  ãŠéƒ¨å±‹ã§ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</h1>
  <p>ã€Œãƒ„ã‚¢ãƒ¼ã‚’é–‹å§‹ã€ã‚’æŠ¼ã™ã¨<br>éŸ³å£°æ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™</p>
  <button onclick="startTour()">ãƒ„ã‚¢ãƒ¼ã‚’é–‹å§‹ï¼ˆGPSè¨±å¯ï¼‰</button>
  <div id="status">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
</div>

<div class="card">
  <h3>ã‚¹ã‚¿ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰</h3>
  <ul id="spotList" class="spot-list">
    </ul>
  <p class="revision">Rev. 4 (Audio Fix)</p>
</div>

<script>
// â˜…éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ã‚‰ã‹ã˜ã‚æº–å‚™ã—ã¦ãŠãã¾ã™ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ï¼‰â˜…
// â€» spot1.mp3 ãŒãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„
const soundEffect = new Audio('spot1.mp3');

// â˜…è¨­å®šã‚¨ãƒªã‚¢â˜…
const spots = [
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã®åº§æ¨™
  { name: "â‘  ãƒ†ã‚¹ãƒˆåœ°ç‚¹ï¼ˆç¾åœ¨åœ°ï¼‰", lat: 34.8397, lng: 134.6776, cleared: false },
  { name: "â‘¡ åŒ—ã«ã‚ã‚‹æ¶ç©ºã®ã‚¹ãƒãƒƒãƒˆ", lat: 34.8344, lng: 134.6934, cleared: false } 
];

// ãƒ†ã‚¹ãƒˆç”¨ã«åºƒã‚ã®500mã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™
const RADIUS = 500; 

function startTour() {
  if (!navigator.geolocation) {
    alert("GPSãŒä½¿ãˆã¾ã›ã‚“");
    return;
  }

  // ã€é‡è¦ã€‘ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸç¬é–“ã«ã€éŸ³å£°ã‚’ã€Œå†ç”Ÿâ†’å³åœæ­¢ã€ã—ã¦
  // ãƒ–ãƒ©ã‚¦ã‚¶ã«ã€ŒéŸ³ã‚’å‡ºã—ã¦ã„ã„ã‚ˆã€ã¨è¨±å¯ã‚’ã‚‚ã‚‰ã„ã¾ã™ï¼ˆã‚¢ãƒ³ãƒ­ãƒƒã‚¯å‡¦ç†ï¼‰
  soundEffect.play().then(() => {
      soundEffect.pause();
      soundEffect.currentTime = 0;
      console.log("éŸ³å£°æ©Ÿèƒ½ï¼šãƒ­ãƒƒã‚¯è§£é™¤æˆåŠŸ");
  }).catch(e => {
      console.log("éŸ³å£°æ©Ÿèƒ½ï¼šãƒ­ãƒƒã‚¯è§£é™¤å¤±æ•—ï¼ˆã¾ã å†ç”Ÿã§ãã¾ã›ã‚“ï¼‰", e);
      document.getElementById("status").innerText = "âš ï¸ ç”»é¢ã‚’ã‚‚ã†ä¸€åº¦ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„";
  });

  // GPSé–‹å§‹
  navigator.geolocation.watchPosition(success, error, {
    enableHighAccuracy: true,
    timeout: 10000,
    maximumAge: 0
  });

  document.getElementById("status").innerText = "ğŸ“¡ åˆ¤å®šä¸­...";
  updateList();
}

function success(position) {
  const currentLat = position.coords.latitude;
  const currentLng = position.coords.longitude;
  
  // é€šå¸¸æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
  // ï¼ˆãŠç¥ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ã„ãªã„æ™‚ã ã‘åº§æ¨™ã‚’è¡¨ç¤ºã™ã‚‹ï¼‰
  const statusDiv = document.getElementById("status");
  if (!statusDiv.innerHTML.includes("ğŸ‰")) {
      statusDiv.innerHTML = `ğŸ“ ã‚ãªãŸã®å ´æ‰€<br>${currentLat.toFixed(5)}, ${currentLng.toFixed(5)}`;
  }

  spots.forEach((spot) => {
    if (spot.cleared) return;

    const dist = getDistance(currentLat, currentLng, spot.lat, spot.lng);
    
    if (dist <= RADIUS) {
      spot.cleared = true;
      
      // â˜…ã“ã“ã§éŸ³ã‚’é³´ã‚‰ã™â˜…
      // alert() ã‚’å‰Šé™¤ã—ãŸã®ã§ã€éŸ³ãŒé€”åˆ‡ã‚Œãšã«å†ç”Ÿã•ã‚Œã¾ã™
      soundEffect.currentTime = 0; // æœ€åˆã‹ã‚‰å†ç”Ÿ
      soundEffect.play().catch(e => console.log("å†ç”Ÿã‚¨ãƒ©ãƒ¼", e));

      // ç”»é¢ä¸Šã®è¡¨ç¤ºã‚’å¤‰ãˆã‚‹ï¼ˆalertã®ä»£ã‚ã‚Šï¼‰
      statusDiv.innerHTML = `<div class='success-msg'>ğŸ‰ ${spot.name}<br>ã‚¹ã‚¿ãƒ³ãƒ—ã‚²ãƒƒãƒˆï¼</div>`;
      
      updateList();
    }
  });
}

function updateList() {
  const list = document.getElementById("spotList");
  list.innerHTML = "";
  spots.forEach(spot => {
    const li = document.createElement("li");
    li.className = "spot-item " + (spot.cleared ? "cleared" : "");
    li.innerText = spot.cleared ? `âœ… ${spot.name}` : `â¬œ ${spot.name}`;
    list.appendChild(li);
  });
}

function error(err) {
  document.getElementById("status").innerText = "âš ï¸ GPSã‚¨ãƒ©ãƒ¼";
}

function getDistance(lat1, lon1, lat2, lon2) {
  const R = 6371000;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}
</script>

</body>
</html>
