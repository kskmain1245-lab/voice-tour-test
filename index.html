<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>éŸ³å£°ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼è·é›¢è¡¨ç¤ºç‰ˆ</title>
<style>
  body { font-family: sans-serif; text-align: center; padding: 20px; background-color: #f0f8ff; }
  .card { background: white; padding: 20px; margin: 10px auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); max-width: 400px; }
  h1 { color: #333; }
  button { font-size: 1.2em; padding: 10px 20px; background-color: #ff6347; color: white; border: none; border-radius: 5px; cursor: pointer; }
  #status { margin-top: 20px; font-weight: bold; min-height: 1.5em; line-height: 1.6; }
  .spot-list { list-style: none; padding: 0; }
  .spot-item { background: #eee; margin: 5px; padding: 10px; border-radius: 5px; }
  .cleared { background-color: #98fb98; font-weight: bold; color: #006400; }
  
  /* è·é›¢è¡¨ç¤ºã‚’ç›®ç«‹ãŸã›ã‚‹ */
  .distance-info { color: #007bff; font-size: 1.1em; margin-top: 5px; }
  .success-msg { color: red; font-size: 1.2em; font-weight: bold; animation: pop 0.5s ease; }
  @keyframes pop { 0% { transform: scale(0.8); } 50% { transform: scale(1.2); } 100% { transform: scale(1.0); } }
  
  .revision { font-size: 10px; color: #aaa; margin-top: 20px; }
</style>
</head>
<body>

<div class="card">
  <h1>ğŸ—ºï¸ éŸ³å£°ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</h1>
  <p>ã‚ã¨ä½•ãƒ¡ãƒ¼ãƒˆãƒ«ã§åˆ°ç€ã™ã‚‹ã‹<br>ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¾ã™</p>
  <button onclick="startTour()">ãƒ„ã‚¢ãƒ¼ã‚’é–‹å§‹ï¼ˆGPSè¨±å¯ï¼‰</button>
  <div id="status">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
</div>

<div class="card">
  <h3>ã‚¹ã‚¿ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰</h3>
  <ul id="spotList" class="spot-list">
    </ul>
  <p class="revision">Rev. 5 (Distance Display)</p>
</div>

<script>
// â˜…éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®æº–å‚™â˜…
const soundEffect = new Audio('spot1.mp3');

// â˜…è¨­å®šã‚¨ãƒªã‚¢â˜…
const spots = [
  // 1. æŒ‡å®šã®ãƒ†ã‚¹ãƒˆåœ°ç‚¹
  { name: "â‘  ãƒ†ã‚¹ãƒˆåœ°ç‚¹", lat: 34.8397, lng: 134.6776, cleared: false },
  
  // 2. åŒ—ã«ã‚ã‚‹æ¶ç©ºã®ã‚¹ãƒãƒƒãƒˆ
  { name: "â‘¡ åŒ—ã®ã‚¹ãƒãƒƒãƒˆ", lat: 34.8344, lng: 134.6934, cleared: false } 
];

// â˜…åˆ¤å®šåŠå¾„ã‚’50mã«æˆ»ã—ã¾ã—ãŸâ˜…
const RADIUS = 50; 

function startTour() {
  if (!navigator.geolocation) {
    alert("GPSãŒä½¿ãˆã¾ã›ã‚“");
    return;
  }

  // éŸ³å£°ã®ã‚¢ãƒ³ãƒ­ãƒƒã‚¯å‡¦ç†ï¼ˆé–‹å§‹æ™‚ã«ä¸€ç¬å†ç”Ÿï¼‰
  soundEffect.play().then(() => {
      soundEffect.pause();
      soundEffect.currentTime = 0;
  }).catch(e => {
      document.getElementById("status").innerText = "âš ï¸ ç”»é¢ã‚’ã‚‚ã†ä¸€åº¦ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„";
  });

  navigator.geolocation.watchPosition(success, error, {
    enableHighAccuracy: true,
    timeout: 10000,
    maximumAge: 0
  });

  document.getElementById("status").innerText = "ğŸ“¡ GPSæ¸¬ä½ä¸­...";
  updateList();
}

function success(position) {
  const currentLat = position.coords.latitude;
  const currentLng = position.coords.longitude;
  
  // 1. ã¾ãšå„ã‚¹ãƒãƒƒãƒˆã¨ã®è·é›¢ã‚’è¨ˆç®—ã—ã¦ã€ä¸€ç•ªè¿‘ã„ç›®æ¨™ã‚’æ¢ã™
  let nearestDist = Infinity;
  let nearestName = "";
  let isJustCleared = false; // ä»Šã¾ã•ã«ã‚¯ãƒªã‚¢ã—ãŸç¬é–“ã‹ï¼Ÿ

  spots.forEach((spot) => {
    if (spot.cleared) return; // æ—¢ã«ã‚¯ãƒªã‚¢æ¸ˆã¿ãªã‚‰è¨ˆç®—ã—ãªã„

    const dist = getDistance(currentLat, currentLng, spot.lat, spot.lng);
    const distToArea = dist - RADIUS; // ã€Œã‚¨ãƒªã‚¢ã®ç«¯ã€ã¾ã§ã®è·é›¢

    // ã‚¨ãƒªã‚¢å†…ã«å…¥ã£ãŸï¼ï¼ˆåˆ¤å®šï¼‰
    if (distToArea <= 0) {
      spot.cleared = true;
      isJustCleared = true;
      
      //
