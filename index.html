<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼ãƒ»ãƒ†ã‚¹ãƒˆ</title>
<style>
  body { font-family: sans-serif; text-align: center; padding: 20px; background-color: #f0f8ff; }
  .card { background: white; padding: 20px; margin: 10px auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); max-width: 400px; }
  h1 { color: #333; }
  button { font-size: 1.2em; padding: 10px 20px; background-color: #ff6347; color: white; border: none; border-radius: 5px; cursor: pointer; }
  #status { margin-top: 20px; font-weight: bold; }
  .spot-list { list-style: none; padding: 0; }
  .spot-item { background: #eee; margin: 5px; padding: 10px; border-radius: 5px; }
  .cleared { background-color: #98fb98; font-weight: bold; } /* ã‚¯ãƒªã‚¢ã—ãŸæ™‚ã®è‰² */
</style>
</head>
<body>

<div class="card">
  <h1>ğŸ—ºï¸ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</h1>
  <p>ã‚¹ãƒãƒƒãƒˆã«è¿‘ã¥ãã¨ã‚¹ã‚¿ãƒ³ãƒ—ãŒæŠ¼ã•ã‚Œã¾ã™ï¼</p>
  <button onclick="startTour()">ãƒ„ã‚¢ãƒ¼ã‚’é–‹å§‹ï¼ˆGPSè¨±å¯ï¼‰</button>
  <div id="status">ç¾åœ¨åœ°ã‚’å–å¾—ã—ã¦ã„ã¾ã›ã‚“</div>
</div>

<div class="card">
  <h3>ã‚¹ã‚¿ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰</h3>
  <ul id="spotList" class="spot-list">
    </ul>
</div>

<script>
// â˜…ã“ã“ãŒè¨­å®šã‚¨ãƒªã‚¢ã§ã™ï¼å¾Œã§ã‚ãªãŸã®å¥½ããªå ´æ‰€ã«æ›¸ãæ›ãˆã¾ã™â˜…
const spots = [
  { name: "ã‚¹ãƒãƒƒãƒˆAï¼ˆé§…å‰ï¼‰", lat: 34.827, lng: 134.693, cleared: false }, // ä¾‹ï¼šå§«è·¯é§…ä»˜è¿‘
  { name: "ã‚¹ãƒãƒƒãƒˆBï¼ˆå…¬åœ’ï¼‰", lat: 34.833, lng: 134.691, cleared: false }, // ä¾‹ï¼šå§«è·¯åŸä»˜è¿‘
  { name: "ã‚¹ãƒãƒƒãƒˆCï¼ˆåºƒå ´ï¼‰", lat: 34.815, lng: 134.685, cleared: false }  // ä¾‹ï¼šæ‰‹æŸ„å±±ä»˜è¿‘
];

const RADIUS = 50; // åå¿œã™ã‚‹åŠå¾„ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰

function startTour() {
  if (!navigator.geolocation) {
    alert("ã“ã®ç«¯æœ«ã§ã¯GPSãŒä½¿ãˆã¾ã›ã‚“ã€‚");
    return;
  }
  // GPSã®ç›£è¦–ã‚’é–‹å§‹
  navigator.geolocation.watchPosition(success, error, { enableHighAccuracy: true });
  document.getElementById("status").innerText = "ğŸ“¡ æ¢ç´¢ä¸­...";
  updateList();
}

function success(position) {
  const currentLat = position.coords.latitude;
  const currentLng = position.coords.longitude;
  document.getElementById("status").innerText = `ğŸ“ ç¾åœ¨åœ°: ${currentLat.toFixed(4)}, ${currentLng.toFixed(4)}`;

  spots.forEach((spot, index) => {
    if (spot.cleared) return; // æ—¢ã«ã‚¯ãƒªã‚¢ã—ã¦ã„ã‚Œã°ã‚¹ã‚­ãƒƒãƒ—

    const dist = getDistance(currentLat, currentLng, spot.lat, spot.lng);
    if (dist <= RADIUS) {
      spot.cleared = true;
      alert(`ğŸ‰ ${spot.name} ã«åˆ°ç€ï¼ã‚¹ã‚¿ãƒ³ãƒ—ã‚²ãƒƒãƒˆï¼`);
      updateList();
      checkGoal();
    }
  });
}

function updateList() {
  const list = document.getElementById("spotList");
  list.innerHTML = "";
  spots.forEach(spot => {
    const li = document.createElement("li");
    li.className = "spot-item " + (spot.cleared ? "cleared" : "");
    li.innerText = spot.cleared ? `âœ… ${spot.name} (GET!)` : `â¬œ ${spot.name}`;
    list.appendChild(li);
  });
}

function checkGoal() {
  const allCleared = spots.every(s => s.cleared);
  if (allCleared) {
    document.getElementById("status").innerHTML = "<h2 style='color:red'>ğŸ† ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼ãŠã‚ã§ã¨ã†ï¼</h2>";
    // ã“ã“ã§ãƒ•ã‚¡ãƒ³ãƒ•ã‚¡ãƒ¼ãƒ¬ãªã©ã‚’é³´ã‚‰ã™å‡¦ç†ã‚’è¿½åŠ ã§ãã¾ã™
  }
}

function error() {
  document.getElementById("status").innerText = "âš ï¸ GPSç­‰ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
}

// 2ç‚¹é–“ã®è·é›¢ã‚’æ¸¬ã‚‹è¨ˆç®—å¼ï¼ˆHaversineï¼‰
function getDistance(lat1, lon1, lat2, lon2) {
  const R = 6371000; // åœ°çƒã®åŠå¾„(m)
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}
</script>

</body>
</html>
